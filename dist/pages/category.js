"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function t(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,a,i){return a&&t(e.prototype,a),i&&t(e,i),e}}(),_wepy=require("./../npm/wepy/lib/wepy.js"),_wepy2=_interopRequireDefault(_wepy),_navbar=require("./../components/navbar.js"),_navbar2=_interopRequireDefault(_navbar),_listnews=require("./../components/listnews.js"),_listnews2=_interopRequireDefault(_listnews),_empty=require("./../components/empty.js"),_empty2=_interopRequireDefault(_empty),_footer=require("./../components/footer.js"),_footer2=_interopRequireDefault(_footer),_loading=require("./../components/loading.js"),_loading2=_interopRequireDefault(_loading),_toast=require("./../components/toast.js"),_toast2=_interopRequireDefault(_toast),_avWeappMin=require("./../utils/av-weapp-min.js"),_avWeappMin2=_interopRequireDefault(_avWeappMin),Category=function(t){function e(){var t,a,i,n;_classCallCheck(this,e);for(var s=arguments.length,o=Array(s),r=0;r<s;r++)o[r]=arguments[r];return a=i=_possibleConstructorReturn(this,(t=e.__proto__||Object.getPrototypeOf(e)).call.apply(t,[this].concat(o))),i.config={},i.$repeat={},i.$props={"nav-bar":{"xmlns:v-bind":"","v-bind:navlist.sync":"navlist"},"news-list":{"v-bind:lists.sync":"listData"},empty:{type:"publish"},"v-loading":{"v-bind:loading.sync":"loading","v-bind:loadend.sync":"loadend"}},i.$events={},i.components={"nav-bar":_navbar2.default,"news-list":_listnews2.default,empty:_empty2.default,footer:_footer2.default,"v-loading":_loading2.default,toast:_toast2.default},i.data={gridsArr:null,curname:"",curTab:"",curType:null,slideUp:!0,loading:!1,loadend:!1,navlist:null,listData:[],initLists:[],scrollTop:0,goTopStauts:0,page:1,pageSize:50},i.methods={slideChange:function(){this.slideUp=!this.slideUp},tabChange:function(t,e){this.curTab=t,this.curname=e,this.slideUp=!this.slideUp,this.navlist=null,this.fetch()},scroll:function(t){t.detail.scrollTop>300?this.goTopStauts=1:this.goTopStauts=0,this.scrollTop=t.detail.scrollTop},scrollFetch:function(){var t=this,e=new _avWeappMin2.default.Query("NewsList");t.loadend||t.loading||(t.loading=!0,e.equalTo("type",t.curTab),e.descending("updatedAt"),e.limit(t.pageSize),e.skip((t.page-1)*t.pageSize),e.find().then(function(e){if(t.loading=!1,0==e.length)return t.loadend=!1,void t.$apply();e.length<t.pageSize&&(t.loadend=!0),t.page++,t.makeParam(e)}).catch(function(e){t.loading=!1,t.$invoke("toast","show",{message:"服务异常，请稍后重试"}),t.$apply()}))},goTop:function(){this.scrollTop=0},publish:function(){wx.navigateTo({url:"publish"})}},i.events={navChange:function(t){this.scrollTop=0,this.goTopStauts=0,this.filterList(t)}},n=a,_possibleConstructorReturn(i,n)}return _inherits(e,t),_createClass(e,[{key:"onLoad",value:function(t){this.curTab=t.id,this.curname=t.name,this.gridsArr=this.$parent.globalData.gridsArr,this.fetch()}},{key:"fetch",value:function(){var t=this,e=new _avWeappMin2.default.Query("NewsList");t.loading=!0,t.initLists.length=0,t.listData.length=0,e.equalTo("type",t.curTab),e.descending("updatedAt"),e.limit(t.pageSize),e.find().then(function(e){if(t.loading=!1,0==e.length)return t.loadend=!1,void t.$apply();e.length<t.pageSize&&(t.loadend=!0),t.page++,t.makeParam(e)}).catch(function(e){t.loading=!1,t.$invoke("toast","show",{message:"服务异常，请稍后重试"}),t.$apply()})}},{key:"checkUserAttentions",value:function(t){for(var e=this.$parent.globalData.curUserAttention,a=0;a<t.length;a++)-1!=e.indexOf(t[a].id)&&(t[a].attentionStatus=1)}},{key:"filterList",value:function(t){var e=[],a=this.initLists,i=this.curTab;if("all"==t)return void(this.listData=a);if("job"==this.curTab||"sale"==this.curTab||"home"==this.curTab){for(var n=0;n<a.length;n++)a[n].formdata[i+"Type"].id==t.id&&e.push(a[n]);this.listData=e}}},{key:"makeParam",value:function(t){for(var e=t.length,a=0;a<e;a++){var i=t[a].attributes;i.id=t[a].id,i.attentionStatus=0,i.updatedAt=this.$parent.timeFormate(t[a].updatedAt),this.listData.push(i)}"job"==this.curTab||"sale"==this.curTab||"home"==this.curTab?(this.curType="all",this.makeNavlist(this.listData)):this.navlist=null,this.checkUserAttentions(this.listData),this.initLists=this.listData,this.$apply()}},{key:"makeNavlist",value:function(t){for(var e=this.curTab,a=t.length,i=[],n=0;n<a;n++){var s=!1,o=t[n].formdata[e+"Type"];if(i.length){for(var r=0;r<i.length;r++)i[r].name==o.name&&(s=!0);s||i.push(o)}else i.push(o)}this.navlist=i}}]),e}(_wepy2.default.page);Page(require("./../npm/wepy/lib/wepy.js").default.$createPage(Category,"pages/category"));